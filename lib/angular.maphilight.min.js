!function(t,i){"function"==typeof define&&define.amd?define(["jquery"],i):i(t.jQuery)}(this,function(t){function a(i){return{restrict:"E",scope:{angularMaphilightConfig:"="},link:function(i,a,e){function o(){var i=t(s).attr("width"),a=t(s).attr("height");if(!i||!a){var e=new Image;e.src=t(s).attr("src"),void 0==e.src&&(e.src=t(s).attr("ng-src")),i||(i=e.width),a||(a=e.height)}var o=t(s).width()/100,r=t(s).height()/100,n=t(s).attr("usemap").replace("#",""),l="coords";t('map[name="'+n+'"]').find("area").each(function(){var e=t(this);e.data(l)||e.data(l,e.attr(l));for(var n=e.data(l).split(","),s=new Array(n.length),h=0;h<s.length;++h)h%2===0?s[h]=parseInt(n[h]/i*100*o):s[h]=parseInt(n[h]/a*100*r);e.attr(l,s.toString())})}function r(){if(i.angularMaphilightConfig){var a=angular.copy(i.angularMaphilightConfig);a.strokeColor&&"#"==a.strokeColor[0]&&(a.strokeColor=a.strokeColor.substr(1)),a.fillColor&&"#"==a.fillColor[0]&&(a.fillColor=a.fillColor.substr(1)),a.shadowColor&&"#"==a.shadowColor[0]&&(a.shadowColor=a.shadowColor.substr(1))}t(s).load(function(){t(s).maphilight(a)}).trigger("load")}var n=t(a),s=n.find("img");t(s).attr("usemap","#"+e.id+".map");var l=n.find("map");t(l).attr("id",e.id+".map"),t(l).attr("name",e.id+".map"),s.bind("load",function(){t(window).resize(function(){t(l).trigger("alwaysOn.maphilight"),o()}).trigger("resize")}),i.$watch("angularMaphilightConfig",r,!0),i.redrawCanvas=function(){r()}},controller:["$scope",function(t){this.redrawCanvas=function(){t.redrawCanvas()}}]}}function e(){return{restrict:"A",require:"^angularMaphilight",scope:{maphilightCustomStyle:"="},link:function(i,a,e,o){i.$watch("maphilightCustomStyle",function(){t(a).data("maphilight",i.maphilightCustomStyle),o.redrawCanvas()},!0)}}}var o,r,n,s,l,h,d,c,p,f,g;if(r=!!document.createElement("canvas").getContext,o=function(){var t=document.createElement("div");t.innerHTML='<v:shape id="vml_flag1" adj="1" />';var i=t.firstChild;return i.style.behavior="url(#default#VML)",!i||"object"==typeof i.adj}(),!r&&!o)return void(t.fn.maphilight=function(){return this});if(r){c=function(t){return Math.max(0,Math.min(parseInt(t,16),255))},p=function(t,i){return"rgba("+c(t.substr(0,2))+","+c(t.substr(2,2))+","+c(t.substr(4,2))+","+i+")"},n=function(i){var a=t('<canvas style="width:'+t(i).width()+"px;height:"+t(i).height()+'px;"></canvas>').get(0);return a.getContext("2d").clearRect(0,0,t(i).width(),t(i).height()),a};var u=function(t,a,e,o,r){if(o=o||0,r=r||0,t.beginPath(),"rect"==a)t.rect(e[0]+o,e[1]+r,e[2]-e[0],e[3]-e[1]);else if("poly"==a)for(t.moveTo(e[0]+o,e[1]+r),i=2;i<e.length;i+=2)t.lineTo(e[i]+o,e[i+1]+r);else"circ"==a&&t.arc(e[0]+o,e[1]+r,e[2],0,2*Math.PI,!1);t.closePath()};s=function(i,a,e,o,r){var n=i.getContext("2d");if(o.shadow){n.save(),"inside"==o.shadowPosition&&(u(n,a,e),n.clip());var s=100*i.width,l=100*i.height;u(n,a,e,s,l),n.shadowOffsetX=o.shadowX-s,n.shadowOffsetY=o.shadowY-l,n.shadowBlur=o.shadowRadius,n.shadowColor=p(o.shadowColor,o.shadowOpacity);var h=o.shadowFrom;h||(h="outside"==o.shadowPosition?"fill":"stroke"),"stroke"==h?(n.strokeStyle="rgba(0,0,0,1)",n.stroke()):"fill"==h&&(n.fillStyle="rgba(0,0,0,1)",n.fill()),n.restore(),"outside"==o.shadowPosition&&(n.save(),u(n,a,e),n.globalCompositeOperation="destination-out",n.fillStyle="rgba(0,0,0,1);",n.fill(),n.restore())}n.save(),u(n,a,e),o.fill&&(n.fillStyle=p(o.fillColor,o.fillOpacity),n.fill()),o.stroke&&(n.strokeStyle=p(o.strokeColor,o.strokeOpacity),n.lineWidth=o.strokeWidth,n.stroke()),n.restore(),o.fade&&t(i).css("opacity",0).animate({opacity:1},100)},l=function(t){t.getContext("2d").clearRect(0,0,t.width,t.height)}}else n=function(i){return t('<var style="zoom:1;overflow:hidden;display:block;width:'+i.width+"px;height:"+i.height+'px;"></var>').get(0)},s=function(i,a,e,o,r){var n,s,l,h;for(var d in e)e[d]=parseInt(e[d],10);n='<v:fill color="#'+o.fillColor+'" opacity="'+(o.fill?o.fillOpacity:0)+'" />',s=o.stroke?'strokeweight="'+o.strokeWidth+'" stroked="t" strokecolor="#'+o.strokeColor+'"':'stroked="f"',l='<v:stroke opacity="'+o.strokeOpacity+'"/>',"rect"==a?h=t('<v:rect name="'+r+'" filled="t" '+s+' style="zoom:1;margin:0;padding:0;display:block;position:absolute;left:'+e[0]+"px;top:"+e[1]+"px;width:"+(e[2]-e[0])+"px;height:"+(e[3]-e[1])+'px;"></v:rect>'):"poly"==a?h=t('<v:shape name="'+r+'" filled="t" '+s+' coordorigin="0,0" coordsize="'+i.width+","+i.height+'" path="m '+e[0]+","+e[1]+" l "+e.join(",")+' x e" style="zoom:1;margin:0;padding:0;display:block;position:absolute;top:0px;left:0px;width:'+i.width+"px;height:"+i.height+'px;"></v:shape>'):"circ"==a&&(h=t('<v:oval name="'+r+'" filled="t" '+s+' style="zoom:1;margin:0;padding:0;display:block;position:absolute;left:'+(e[0]-e[2])+"px;top:"+(e[1]-e[2])+"px;width:"+2*e[2]+"px;height:"+2*e[2]+'px;"></v:oval>')),h.get(0).innerHTML=n+l,t(i).append(h)},l=function(i){var a=t("<div>"+i.innerHTML+"</div>");a.children("[name=highlighted]").remove(),i.innerHTML=a.html()};h=function(t){var i,a=t.getAttribute("coords").split(",");for(i=0;i<a.length;i++)a[i]=parseFloat(a[i]);return[t.getAttribute("shape").toLowerCase().substr(0,4),a]},g=function(i,a){var e=t(i);return t.extend({},a,!!t.metadata&&e.metadata(),e.data("maphilight"))},f=function(t){return!!t.complete&&("undefined"==typeof t.naturalWidth||0!==t.naturalWidth)},d={position:"absolute",left:0,top:0,padding:0,border:0};var m=!1;t.fn.maphilight=function(i){return i=t.extend({},t.fn.maphilight.defaults,i),r||m||(t(window).ready(function(){document.namespaces.add("v","urn:schemas-microsoft-com:vml");var i=document.createStyleSheet(),a=["shape","rect","oval","circ","fill","stroke","imagedata","group","textbox"];t.each(a,function(){i.addRule("v\\:"+this,"behavior: url(#default#VML); antialias:true")})}),m=!0),this.each(function(){var a,e,c,p,u,m,v;if(a=t(this),!f(this))return window.setTimeout(function(){a.maphilight(i)},200);if(c=t.extend({},i,!!t.metadata&&a.metadata(),a.data("maphilight")),v=a.get(0).getAttribute("usemap"),v&&(p=t('map[name="'+v.substr(1)+'"]'),a.is('img,input[type="image"]')&&v&&p.size()>0)){if(a.hasClass("maphilighted")){var w=a.parent();a.insertBefore(w),w.remove(),t(p).unbind(".maphilight")}e=t("<div></div>").css({display:"block",backgroundImage:'url("'+this.src+'")',backgroundSize:"contain",backgroundRepeat:"no-repeat",position:"relative",padding:0,width:this.width,height:this.height}),c.wrapClass&&(c.wrapClass===!0?e.addClass(t(this).attr("class")):e.addClass(c.wrapClass)),a.before(e).css("opacity",0).css(d).remove(),o&&a.css("filter","Alpha(opacity=0)"),e.append(a),u=n(this),t(u).css(d),u.height=this.height,u.width=this.width,t(p).bind("alwaysOn.maphilight",function(){m&&l(m),r||t(u).empty(),t(p).find("area[coords]").each(function(){var i,e;e=g(this,c),e.shadow=!1,e.alwaysOn&&(!m&&r&&(m=n(a[0]),t(m).css(d),m.width=a[0].width,m.height=a[0].height,a.before(m)),e.fade=e.alwaysOnFade,i=h(this),r?s(m,i[0],i[1],e,""):s(u,i[0],i[1],e,""))})}).trigger("alwaysOn.maphilight").bind("mouseover.maphilight, focus.maphilight",function(i){var a,e,o=i.target;if(e=g(o,c),e.stroke=!1,e["false"]=!1,!e.neverOn){if(a=h(o),s(u,a[0],a[1],e,"highlighted"),e.groupBy){var n;n=/^[a-zA-Z][\-a-zA-Z]+$/.test(e.groupBy)?p.find("area["+e.groupBy+'="'+t(o).attr(e.groupBy)+'"]'):p.find(e.groupBy);var l=o;n.each(function(){if(this!=l){var t=g(this,c);if(!t.neverOn&&!t.alwaysOn){var i=h(this);s(u,i[0],i[1],t,"highlighted")}}})}r||t(u).append("<v:rect></v:rect>")}}).bind("mouseout.maphilight, blur.maphilight",function(t){l(u)}),a.before(u),a.addClass("maphilighted"),t(window).resize(function(){t(p).trigger("alwaysOn.maphilight")}).trigger("resize")}})},t.fn.maphilight.defaults={fill:!0,fillColor:"000000",fillOpacity:.2,stroke:!0,strokeColor:"ff0000",strokeOpacity:1,strokeWidth:1,fade:!0,alwaysOn:!1,neverOn:!1,groupBy:!1,wrapClass:!0,shadow:!1,shadowX:0,shadowY:0,shadowRadius:6,shadowColor:"000000",shadowOpacity:.8,shadowPosition:"outside",shadowFrom:!1},angular.module("ngMapHilight",[]).directive("angularMaphilight",a).directive("maphilightCustomStyle",e),a.$inject=["$window"],e.$inject=[]});